// ==UserScript==
// @name         wplace.live helper utils
// @description  A set of Quality of Life tools for wplace.live website
// @version      0.4.1
// @match        https://wplace.live/*
// @run-at       document-start
// @grant        none
// @updateURL    https://raw.githubusercontent.com/sukui24/Wplace-ColorDetector/main/assets/WplaceHelperUtils.user.js
// @downloadURL  https://raw.githubusercontent.com/sukui24/Wplace-ColorDetector/main/assets/WplaceHelperUtils.user.js
// ==/UserScript==

(()=>{const e=e=>Math.round((e-81)/.6),t=e=>Math.round(.6*e+81),n=e=>e<0?0:e>255?255:0|e,r={r:0,g:0,b:0},o=[{id:0,premium:!1,name:"Transparent",rgb:[0,0,0]},{id:1,premium:!1,name:"Black",rgb:[0,0,0]},{id:2,premium:!1,name:"Dark Gray",rgb:[60,60,60]},{id:3,premium:!1,name:"Gray",rgb:[120,120,120]},{id:4,premium:!1,name:"Light Gray",rgb:[210,210,210]},{id:5,premium:!1,name:"White",rgb:[255,255,255]},{id:6,premium:!1,name:"Deep Red",rgb:[96,0,24]},{id:7,premium:!1,name:"Red",rgb:[237,28,36]},{id:8,premium:!1,name:"Orange",rgb:[255,127,39]},{id:9,premium:!1,name:"Gold",rgb:[246,170,9]},{id:10,premium:!1,name:"Yellow",rgb:[249,221,59]},{id:11,premium:!1,name:"Light Yellow",rgb:[255,250,188]},{id:12,premium:!1,name:"Dark Green",rgb:[14,185,104]},{id:13,premium:!1,name:"Green",rgb:[19,230,123]},{id:14,premium:!1,name:"Light Green",rgb:[135,255,94]},{id:15,premium:!1,name:"Dark Teal",rgb:[12,129,110]},{id:16,premium:!1,name:"Teal",rgb:[16,174,166]},{id:17,premium:!1,name:"Light Teal",rgb:[19,225,190]},{id:18,premium:!1,name:"Dark Blue",rgb:[40,80,158]},{id:19,premium:!1,name:"Blue",rgb:[64,147,228]},{id:20,premium:!1,name:"Cyan",rgb:[96,247,242]},{id:21,premium:!1,name:"Indigo",rgb:[107,80,246]},{id:22,premium:!1,name:"Light Indigo",rgb:[153,177,251]},{id:23,premium:!1,name:"Dark Purple",rgb:[120,12,153]},{id:24,premium:!1,name:"Purple",rgb:[170,56,185]},{id:25,premium:!1,name:"Light Purple",rgb:[224,159,249]},{id:26,premium:!1,name:"Dark Pink",rgb:[203,0,122]},{id:27,premium:!1,name:"Pink",rgb:[236,31,128]},{id:28,premium:!1,name:"Light Pink",rgb:[243,141,169]},{id:29,premium:!1,name:"Dark Brown",rgb:[104,70,52]},{id:30,premium:!1,name:"Brown",rgb:[149,104,42]},{id:31,premium:!1,name:"Beige",rgb:[248,178,119]},{id:32,premium:!0,name:"Medium Gray",rgb:[170,170,170]},{id:33,premium:!0,name:"Dark Red",rgb:[165,14,30]},{id:34,premium:!0,name:"Light Red",rgb:[250,128,114]},{id:35,premium:!0,name:"Dark Orange",rgb:[228,92,26]},{id:36,premium:!0,name:"Light Tan",rgb:[214,181,148]},{id:37,premium:!0,name:"Dark Goldenrod",rgb:[156,132,49]},{id:38,premium:!0,name:"Goldenrod",rgb:[197,173,49]},{id:39,premium:!0,name:"Light Goldenrod",rgb:[232,212,95]},{id:40,premium:!0,name:"Dark Olive",rgb:[74,107,58]},{id:41,premium:!0,name:"Olive",rgb:[90,148,74]},{id:42,premium:!0,name:"Light Olive",rgb:[132,197,115]},{id:43,premium:!0,name:"Dark Cyan",rgb:[15,121,159]},{id:44,premium:!0,name:"Light Cyan",rgb:[187,250,242]},{id:45,premium:!0,name:"Light Blue",rgb:[125,199,255]},{id:46,premium:!0,name:"Dark Indigo",rgb:[77,49,184]},{id:47,premium:!0,name:"Dark Slate Blue",rgb:[74,66,132]},{id:48,premium:!0,name:"Slate Blue",rgb:[122,113,196]},{id:49,premium:!0,name:"Light Slate Blue",rgb:[181,174,241]},{id:50,premium:!0,name:"Light Brown",rgb:[219,164,99]},{id:51,premium:!0,name:"Dark Beige",rgb:[209,128,81]},{id:52,premium:!0,name:"Light Beige",rgb:[255,197,165]},{id:53,premium:!0,name:"Dark Peach",rgb:[155,82,73]},{id:54,premium:!0,name:"Peach",rgb:[209,128,120]},{id:55,premium:!0,name:"Light Peach",rgb:[250,182,164]},{id:56,premium:!0,name:"Dark Tan",rgb:[123,99,82]},{id:57,premium:!0,name:"Tan",rgb:[156,132,107]},{id:58,premium:!0,name:"Dark Slate",rgb:[51,57,65]},{id:59,premium:!0,name:"Slate",rgb:[109,117,141]},{id:60,premium:!0,name:"Light Slate",rgb:[179,185,209]},{id:61,premium:!0,name:"Dark Stone",rgb:[109,100,63]},{id:62,premium:!0,name:"Stone",rgb:[148,140,107]},{id:63,premium:!0,name:"Light Stone",rgb:[205,197,158]}].filter((e=>"Transparent"!==e.name)).map((e=>{const r={r:0,g:0,b:0};var o,i,a,l;return o=e.rgb[0],i=e.rgb[1],a=e.rgb[2],(l=r).r=n(t(o)),l.g=n(t(i)),l.b=n(t(a)),{...e,tinted:[r.r,r.g,r.b]}})),i=(e,t)=>Math.max(Math.abs(e[0]-t[0]),Math.abs(e[1]-t[1]),Math.abs(e[2]-t[2]));(()=>{const e=document.createElement("script");e.textContent=`(${()=>{const e=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(t,n){if("webgl"===t||"webgl2"===t||"experimental-webgl"===t){const r=Object.assign({preserveDrawingBuffer:!0},n||{}),o=e.call(this,t,r);return o&&!this.__wplaceHooked&&(this.__wplaceHooked=!0,this.setAttribute("data-wplace-gl","1")),o}return e.call(this,t,n)},window.__wplace_getContext_patched__=!0}})();`,document.documentElement.appendChild(e),e.remove()})();(async()=>{const t=await new Promise((e=>{const t=document.querySelector(".maplibregl-canvas");if(t)return e(t);const n=new MutationObserver((()=>{const t=document.querySelector(".maplibregl-canvas");t&&(n.disconnect(),e(t))}));n.observe(document.documentElement,{childList:!0,subtree:!0})})),a=t.getContext("webgl2")||t.getContext("webgl")||t.getContext("experimental-webgl");if(!a)return void console.warn("[wplace] No WebGL context available; cannot sample.");const l=document.createElement("div"),d=localStorage.getItem("colorDetectorPosition");let s=d?JSON.parse(d):{right:20,top:"60%"};const m=window.innerWidth-s.right-250;Object.assign(l.style,{position:"fixed",left:m+"px",top:"string"==typeof s.top?s.top:s.top+"px",transform:"string"==typeof s.top?"translateY(-50%)":"none",zIndex:999999,font:"16px/1.4 monospace",padding:"12px 16px",background:"rgba(0,0,0,0.75)",color:"#fff",borderRadius:"12px",pointerEvents:"auto",whiteSpace:"nowrap",display:"flex",flexDirection:"column",gap:"4px",cursor:"move",userSelect:"none",minWidth:"250px",width:"fit-content",maxWidth:"400px",boxSizing:"border-box"});const p=document.createElement("div");p.style.cssText="display: flex; align-items: center; gap: 8px; margin-bottom: 4px; padding-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,.2);";const c=document.createElement("span");c.style.cssText="font-weight: bold; color: #60a5fa; flex: 1;",c.textContent="Color Detector";const g=document.createElement("button");g.id="settings-toggle",g.style.cssText="background: none; color: white; padding: 4px 6px; border-radius: 4px; font-size: 24px; cursor: pointer; font-family: monospace; border: none;",g.textContent="âš™",p.appendChild(c),p.appendChild(g);const u=document.createElement("div"),b=document.createElement("div");b.style.cssText="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;";const x=document.createElement("span");x.style.cssText="flex-shrink: 0;";const h=document.createElement("span");h.style.cssText="display: inline-block; width: 16px; height: 16px; border: 1px solid #fff; margin-left: 8px; vertical-align: middle;",b.appendChild(x),b.appendChild(h);const f=document.createElement("div");f.style.cssText="display: flex; align-items: center; gap: 8px;";const y=document.createElement("button");y.id="smart-brush-toggle",y.style.cssText="background: none; color: white; border: 1px solid rgba(255,255,255,0.3); padding: 6px 8px; border-radius: 4px; font-size: 14px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px;",y.title="Smart Brush - Automatically select colors while painting with spacebar or mouse. Detects the color you're hovering over and switches to it before painting.",y.textContent="ðŸ–Œï¸ Smart Brush";const w=document.createElement("div");w.style.cssText="width: 8px; height: 8px; background: #22c55e; border-radius: 50%; flex-shrink: 0; display: none;",w.title="Color available for painting",f.appendChild(y),f.appendChild(w);const v=document.createElement("div");v.style.cssText="padding: 8px; background: rgba(255,255,255,.05); border-radius: 6px; margin-top: 8px; display: none;";const k=document.createElement("div");k.style.cssText="font-weight: bold; margin-bottom: 8px; color: #60a5fa;",k.textContent="Settings";const C=document.createElement("label");C.style.cssText="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 14px;";const S=document.createElement("input");S.type="checkbox",S.id="area-calc-toggle",S.style.cssText="margin: 0;";const L=document.createElement("span");L.textContent="Show Area Calculator",C.appendChild(S),C.appendChild(L),v.appendChild(k),v.appendChild(C),l.appendChild(p),l.appendChild(u),l.appendChild(b),l.appendChild(f),l.appendChild(v);let E=!1,B={x:0,y:0};l.addEventListener("mousedown",(e=>{E=!0;const t=l.getBoundingClientRect();B.x=e.clientX-t.left,B.y=e.clientY-t.top,l.style.cursor="grabbing",l.style.opacity="0.8"})),document.addEventListener("mousemove",(e=>{(e=>{if(!E)return;e.preventDefault();const t=e.clientX-B.x,n=e.clientY-B.y,r=window.innerWidth,o=window.innerHeight,i=l.offsetWidth,a=l.offsetHeight,d=Math.max(10,Math.min(t,r-i-10)),s=Math.max(10,Math.min(n,o-a-10));l.style.left=d+"px",l.style.top=s+"px",l.style.right="auto",l.style.transform="none"})(e),$(e)})),document.addEventListener("mouseup",(()=>{(()=>{if(!E)return;E=!1,l.style.cursor="move",l.style.opacity="1";const e=l.getBoundingClientRect(),t=window.innerWidth,n=(window.innerHeight,{right:t-e.right,top:e.top});localStorage.setItem("colorDetectorPosition",JSON.stringify(n))})(),I()})),window.addEventListener("resize",(()=>{if(R=null,le.clear(),!E){const e=localStorage.getItem("colorDetectorPosition");if(e){const t=JSON.parse(e),n=window.innerWidth-t.right-250;l.style.left=n+"px",l.style.top=t.top+"px",l.style.right="auto",l.style.transform="none"}}if(!P){const e=localStorage.getItem("areaCalculatorPosition");if(e){const t=JSON.parse(e);D.style.right=t.right+"px",D.style.bottom=t.bottom+"px",D.style.left="auto",D.style.top="auto"}}})),document.body.appendChild(l);const D=document.createElement("div"),T=localStorage.getItem("areaCalculatorPosition");let Y=T?JSON.parse(T):{right:20,bottom:20};Object.assign(D.style,{position:"fixed",right:Y.right+"px",bottom:Y.bottom+"px",zIndex:999998,font:"14px/1.4 monospace",padding:"16px",background:"rgba(0,0,0,0.75)",color:"#fff",borderRadius:"12px",pointerEvents:"auto",width:"300px",maxWidth:"300px",border:"1px solid rgba(255,255,255,.2)",cursor:"move",userSelect:"none",boxSizing:"border-box"});let P=!1,X={x:0,y:0};const $=e=>{if(!P)return;e.preventDefault();const t=e.clientX-X.x,n=e.clientY-X.y,r=window.innerWidth,o=window.innerHeight,i=D.offsetWidth,a=D.offsetHeight,l=Math.max(10,Math.min(t,r-i-10)),d=Math.max(10,Math.min(n,o-a-10));D.style.left=l+"px",D.style.top=d+"px",D.style.right="auto",D.style.bottom="auto"},I=()=>{if(!P)return;P=!1,D.style.cursor="move",D.style.opacity="1";const e=D.getBoundingClientRect(),t=window.innerWidth,n=window.innerHeight,r={right:t-e.right,bottom:n-e.bottom};localStorage.setItem("areaCalculatorPosition",JSON.stringify(r))};D.addEventListener("mousedown",(e=>{const t=document.getElementById("drag-handle");if(!t||!t.contains(e.target)&&"BUTTON"===e.target.tagName)return;P=!0;const n=D.getBoundingClientRect();X.x=e.clientX-n.left,X.y=e.clientY-n.top,D.style.cursor="grabbing",D.style.opacity="0.8"}));let M=null,z=null,G={x:0,y:0,tlX:0,tlY:0,pxX:0,pxY:0},O=!0,W="false"!==localStorage.getItem("showAreaCalculator"),N=!1;const A=()=>{const e=document.querySelector("#bm-h");if(e){const t=e.textContent.match(/\(Tl X: (\d+), Tl Y: (\d+), Px X: (\d+), Px Y: (\d+)\)/);if(t)return{tlX:parseInt(t[1]),tlY:parseInt(t[2]),pxX:parseInt(t[3]),pxY:parseInt(t[4]),finalX:1e3*parseInt(t[1])+parseInt(t[3]),finalY:1e3*parseInt(t[2])+parseInt(t[4])}}return null},q=()=>{let e=0,t=0,n=0;if(M&&z){const r=1e3*M.tlX+M.pxX,o=1e3*M.tlY+M.pxY,i=1e3*z.tlX+z.pxX,a=1e3*z.tlY+z.pxY;t=Math.abs(i-r)+1,n=Math.abs(a-o)+1,e=t*n}const r=`\n        <div style="margin-bottom: 8px;">\n          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px; flex-wrap: wrap;">\n            <span style="width: 80px; flex-shrink: 0;">Corner 1:</span>\n            <span style="color: ${M?"#4ade80":"#94a3b8"}; word-wrap: break-word; flex: 1; min-width: 0;">\n              ${M?`${(1e3*M.tlX+M.pxX).toLocaleString()}, ${(1e3*M.tlY+M.pxY).toLocaleString()}`:"Not set"}\n            </span>\n            <button id="geo-tl" style="\n              background: #3b82f6; \n              color: white; \n              border: none; \n              padding: 4px 8px; \n              border-radius: 4px; \n              font-size: 12px; \n              cursor: pointer;\n              font-family: monospace;\n              pointer-events: auto;\n              flex-shrink: 0;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n            ">Set</button>\n          </div>\n        </div>\n        \n        <div style="margin-bottom: 12px;">\n          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px; flex-wrap: wrap;">\n            <span style="width: 80px; flex-shrink: 0;">Corner 2:</span>\n            <span style="color: ${z?"#4ade80":"#94a3b8"}; word-wrap: break-word; flex: 1; min-width: 0;">\n              ${z?`${(1e3*z.tlX+z.pxX).toLocaleString()}, ${(1e3*z.tlY+z.pxY).toLocaleString()}`:"Not set"}\n            </span>\n            <button id="geo-br" style="\n              background: #3b82f6; \n              color: white; \n              border: none; \n              padding: 4px 8px; \n              border-radius: 4px; \n              font-size: 12px; \n              cursor: pointer;\n              font-family: monospace;\n              pointer-events: auto;\n              flex-shrink: 0;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n            ">Set</button>\n          </div>\n        </div>\n        \n        <div style="padding: 8px; background: rgba(255,255,255,.1); border-radius: 6px; word-wrap: break-word;">\n          <div style="font-weight: bold; color: ${e>0?"#fbbf24":"#94a3b8"};">\n            Area: ${e>0?e.toLocaleString():"0"} pixels\n          </div>\n          ${e>0?`\n            <div style="font-size: 12px; color: #94a3b8; margin-top: 4px;">\n              Width: ${t.toLocaleString()} Ã— Height: ${n.toLocaleString()}\n            </div>\n          `:""}\n        </div>\n        \n        <div style="margin-top: 12px;">\n          <button id="clear-area" style="\n            background: #ef4444; \n            color: white; \n            border: none; \n            padding: 6px 12px; \n            border-radius: 6px; \n            font-size: 12px; \n            cursor: pointer;\n            font-family: monospace;\n            pointer-events: auto;\n          ">Clear</button>\n        </div>\n      `;D.innerHTML=`\n        <div id="drag-handle" style="\n          display: flex; \n          align-items: center; \n          justify-content: space-between; \n          margin-bottom: ${O?"12px":"0"};\n          cursor: move;\n          padding: 4px 0;\n          border-bottom: ${O?"1px solid rgba(255,255,255,.1)":"none"};\n          margin-bottom: ${O?"8px":"0"};\n        ">\n          <div style="font-weight: bold; color: #4ade80;">\n            Area Calculator\n          </div>\n          <button id="expand-toggle" style="\n            background: none; \n            color: white; \n            border: 1px solid rgba(255,255,255,.3); \n            padding: 4px 8px; \n            border-radius: 4px; \n            font-size: 12px; \n            cursor: pointer;\n            font-family: monospace;\n          ">${O?"âˆ’":"+"}</button>\n        </div>\n        ${O?r:""}\n      `;const o=document.getElementById("geo-tl"),i=document.getElementById("geo-br"),a=document.getElementById("clear-area"),l=document.getElementById("expand-toggle");l&&l.addEventListener("click",(()=>{O=!O,q()})),o&&o.addEventListener("click",(()=>{const e=A();e&&(M={tlX:e.tlX,tlY:e.tlY,pxX:e.pxX,pxY:e.pxY},q())})),i&&i.addEventListener("click",(()=>{const e=A();e&&(z={tlX:e.tlX,tlY:e.tlY,pxX:e.pxX,pxY:e.pxY},q())})),a&&a.addEventListener("click",(()=>{M=null,z=null,q()}))};q(),W&&document.body.appendChild(D);const H=new Uint8Array(4);let R=null,_=0;let j,J=!1,F=0;let U=!document.hidden;document.addEventListener("visibilitychange",(()=>{U=!document.hidden,U?console.log("[wplace] Tab visible - resuming normal sampling"):(J&&(J=!1),console.log("[wplace] Tab hidden - reducing sampling rate"))}));let K=!1,Q=null,V=null,Z=null;let ee="",te="",ne=!1,re=-1,oe=-1;const ie=(e,t,n)=>{u.textContent=e,x.textContent=t,n?(h.style.backgroundColor=`rgb(${n.rgb[0]},${n.rgb[1]},${n.rgb[2]})`,h.style.display="inline-block"):h.style.display="none",!K||!n||n.premium&&document.querySelector(`#color-${n.id}`)?.querySelector("svg")?w.style.display="none":w.style.display="block",S.checked=W};g.addEventListener("click",(e=>{e.stopPropagation(),N=!N,v.style.display=N?"block":"none"})),y.addEventListener("click",(e=>{e.stopPropagation(),K=!K,K?(y.style.background="rgba(34, 197, 94, 0.3)",y.style.border="2px solid #22c55e",V=null,console.log("[Smart Brush] Activated - ready to detect colors")):(y.style.background="none",y.style.border="1px solid rgba(255,255,255,0.3)",console.log("[Smart Brush] Deactivated")),j&&!J&&(J=!0,requestAnimationFrame(ae))})),S.addEventListener("change",(e=>{e.stopPropagation(),W=e.target.checked,localStorage.setItem("showAreaCalculator",W.toString()),W?document.body.appendChild(D):D.parentNode&&D.parentNode.removeChild(D)}));const ae=l=>{if(J=!1,!j)return;if(l-F<(U?30:5e3))return;if(!U)return void(F=l);if(F=l,j.x===re&&j.y===oe)return;re=j.x,oe=j.y;const d=(()=>{const e=performance.now();return(!R||e-_>100)&&(R=t.getBoundingClientRect(),_=e),R})(),s=j.clientX-d.left,m=j.clientY-d.top,p=a.drawingBufferWidth,c=a.drawingBufferHeight,g=Math.max(0,Math.min(p-1,Math.floor(s*p/d.width))),u=Math.max(0,Math.min(c-1,Math.floor((d.height-m)*c/d.height)));G={x:g,y:u},q();try{a.readPixels(g,u,1,1,a.RGBA,a.UNSIGNED_BYTE,H)}catch(e){return void console.warn("[wplace] readPixels failed:",e)}const[b,x,h,f]=H,y=(((e,t,n)=>{})(b,x,h),w=x,v=h,(k=r).r=n(e(b)),k.g=n(e(w)),k.b=n(e(v)),k);var w,v,k;let C=(e=>{let t=null,n=1/0;for(const r of o){const o=i(e,r.tinted);if(o<n&&(n=o,t=r),0===o)break}return t&&n<=3?t:null})([b,x,h])||(e=>{let t=null,n=1/0;for(const r of o){const o=i(e,r.rgb);if(o<n&&(n=o,t=r),0===o)break}return t&&n<=3?t:null})([b,x,h]);Q=C;const S=C?`Palette: ${C.name} (id ${C.id})`:"Palette: -",L=(C&&(C.rgb[0],C.rgb[1],C.rgb[2]),`RGB: ${y.r},${y.g},${y.b}`);(L!==ee||S!==te||K!==ne)&&(ee=L,te=S,ne=K,ie(L,S,C))};t.addEventListener("mousemove",(e=>{j=e,J||(J=!0,requestAnimationFrame(ae))}),{passive:!0});const le=new Map;let de=0;const se=e=>{const t=performance.now();if((t-de>1e3||le.size>64)&&(le.clear(),de=t),!le.has(e)){const t=document.querySelector(`#color-${e}`);t&&le.set(e,t)}return le.get(e)||null},me=e=>{const t=se(e);if(t){return null!==t.querySelector("svg")?(console.log("[Smart Brush] Color is locked, cannot select:",e),!1):(t.click(),console.log("[Smart Brush] Selected color:",e),!0)}return!1};let pe=!1;document.addEventListener("keydown",(e=>{if("Space"===e.code&&K&&!pe&&j&&document.elementFromPoint(j.clientX,j.clientY)===t&&(pe=!0,Q&&Q.id!==V)){if(Q.premium){const t=se(Q.id);if(t&&t.querySelector("svg"))return console.log("[Smart Brush] Cannot paint with locked color:",Q.name),e.preventDefault(),void e.stopPropagation()}me(Q.id)&&(V=Q.id,console.log("[Smart Brush] Color changed to:",Q.name),j&&!J&&(J=!0,requestAnimationFrame(ae)))}}),!0),document.addEventListener("keyup",(e=>{"Space"===e.code&&(pe=!1)}),!0),t.addEventListener("mousedown",(e=>{var t;if(0===e.button&&(K&&Q&&Q.id!==V)){if(Q.premium){const t=se(Q.id);if(t&&t.querySelector("svg"))return console.log("[Smart Brush] Cannot paint with locked color:",Q.name),e.preventDefault(),void e.stopPropagation()}t=Q.id,Z&&(clearTimeout(Z),Z=null),Z=setTimeout((()=>{me(t)&&(V=t,console.log("[Smart Brush] Debounced color change to:",t),j&&!J&&(J=!0,requestAnimationFrame(ae)))}),16)}}),!0),setInterval((()=>{le.size>32&&(le.clear(),console.log("[wplace] Periodic cache cleanup performed")),R=null}),3e4),window.__wplaceCleanup=()=>{le.clear(),R=null,Z&&(clearTimeout(Z),Z=null),console.log("[wplace] Cleanup performed")},console.log("[wplace] pixel sampler ready (WebGL, optimized memory usage, detint + palette + area calculator + smart brush).")})()})();
